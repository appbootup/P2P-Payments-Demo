<!--
   Permission is granted to copy, distribute and/or modify this document
   under the terms of the GNU Free Documentation License, Version 1.3
   or any later version published by the Free Software Foundation;
   with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.
   A copy of the license is included in the folder entitled "GNU
   Free Documentation License".
   Crowdfunding Scenario 3: Insufficient funding (single user).
   -->
<html>
   <head></head>
   <body>
      <script type="text/javascript" src="web3.min.js"></script>
      <script type='text/javascript'>
         var Web3 = require('web3');
         if (typeof web3 !== 'undefined') {
           web3 = new Web3(web3.currentProvider);
         } else {
           web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
         }
         web3.eth.defaultAccount = web3.eth.accounts[0];
         // Crowdfunding contract:
        var crowdfundContract = web3.eth.contract([{ "constant": true, "inputs": [], "name": "DISTRIBUTED_STATUS", "outputs": [{ "name": "", "type": "uint256" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "REQUEST_CANCELED_BY_CREATOR", "outputs": [{ "name": "", "type": "uint256" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "SUFFICIENT_STATUS", "outputs": [{ "name": "", "type": "uint256" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [{ "name": "amount", "type": "uint256" }, { "name": "index", "type": "uint256" }, { "name": "resetAddy", "type": "address" }], "name": "setInvestmentAmountAtIndexForAddress", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [{ "name": "index", "type": "uint256" }], "name": "stateFail", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [{ "name": "index", "type": "uint256" }], "name": "acceptProposal", "outputs": [{ "name": "", "type": "bool" }], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [], "name": "FAILED_STATUS", "outputs": [{ "name": "", "type": "uint256" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [{ "name": "index", "type": "uint256" }], "name": "reclaimTokens", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [], "name": "PROPOSED_STATUS", "outputs": [{ "name": "", "type": "uint256" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [{ "name": "", "type": "uint256" }], "name": "ideas", "outputs": [{ "name": "title", "type": "string" }, { "name": "description", "type": "string" }, { "name": "minGoal", "type": "uint256" }, { "name": "maxGoal", "type": "uint256" }, { "name": "hostCut", "type": "uint256" }, { "name": "duration", "type": "uint256" }, { "name": "startTime", "type": "uint256" }, { "name": "status", "type": "uint256" }, { "name": "amountRaisedSoFar", "type": "uint256" }, { "name": "host", "type": "address" }, { "name": "tokenAddress", "type": "address" }, { "name": "creator", "type": "address" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [{ "name": "index", "type": "uint256" }], "name": "distributeSuccessfulCampaignFunds", "outputs": [{ "name": "", "type": "bool" }], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [{ "name": "index", "type": "uint256" }], "name": "cancelProposalByCreator", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [{ "name": "index", "type": "uint256" }], "name": "rejectProposalAsHost", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [{ "name": "title", "type": "string" }, { "name": "description", "type": "string" }, { "name": "minGoal", "type": "uint256" }, { "name": "maxGoal", "type": "uint256" }, { "name": "hostCut", "type": "uint256" }, { "name": "duration", "type": "uint256" }, { "name": "host", "type": "address" }, { "name": "tokenAddress", "type": "address" }], "name": "makeProposal", "outputs": [{ "name": "", "type": "uint256" }], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [], "name": "REQUEST_REJECTED_BY_HOST", "outputs": [{ "name": "", "type": "uint256" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [], "name": "advanceBlock", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [], "name": "UNDERWAY_STATUS", "outputs": [{ "name": "", "type": "uint256" }], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [{ "name": "amount", "type": "uint256" }, { "name": "index", "type": "uint256" }], "name": "pledgeTokens", "outputs": [{ "name": "", "type": "bool" }], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "inputs": [], "payable": false, "stateMutability": "nonpayable", "type": "constructor" }, { "anonymous": false, "inputs": [{ "indexed": false, "name": "index", "type": "uint256" }], "name": "ProposalCreatedAtIndex", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "name": "index", "type": "uint256" }], "name": "ProposalCanceledByCreatorAtIndex", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "name": "index", "type": "uint256" }], "name": "ProposalCanceledByHostAtIndex", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "name": "index", "type": "uint256" }], "name": "ProposalAcceptedAtIndex", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "name": "investor", "type": "address" }, { "indexed": false, "name": "amount", "type": "uint256" }, { "indexed": false, "name": "index", "type": "uint256" }], "name": "InvestorInvestedAmountAtIndex", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "name": "index", "type": "uint256" }], "name": "IdeaAtIndexFailed", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "name": "investor", "type": "address" }, { "indexed": false, "name": "amount", "type": "uint256" }, { "indexed": false, "name": "index", "type": "uint256" }], "name": "InvestorReclaimedAmountAtIndex", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "name": "hostCut", "type": "uint256" }, { "indexed": false, "name": "creatorCut", "type": "uint256" }, { "indexed": false, "name": "index", "type": "uint256" }], "name": "FundingDistributed", "type": "event" }, { "anonymous": false, "inputs": [{ "indexed": false, "name": "hostCut", "type": "uint256" }, { "indexed": false, "name": "creatorCut", "type": "uint256" }, { "indexed": false, "name": "index", "type": "uint256" }], "name": "IdeaSoldOutAtIndex", "type": "event" }]);
        var crowdfund = crowdfundContract.new(
        {
            from: web3.eth.accounts[0],
            data: '0x6060604052341561000f57600080fd5b6001805560028055600380556004805560058055600680556007805561195c8061003a6000396000f3006060604052600436106100e25763ffffffff60e060020a60003504166305e24a9381146100e75780630b679d2c1461010c5780631d15f3171461011f5780633a93f2ae14610132578063602d7d621461015957806360c5cc3a1461016f57806361bd12e0146101995780637760da7f146101ac5780638276bd19146101c257806395b53837146101d557806396ebabba146103795780639fb3d4891461038f578063b73fefe8146103a5578063dda178f1146103bb578063e66d987414610478578063e9f5b3c41461048b578063ea885b551461049e578063ee0fdd0f146104b1575b600080fd5b34156100f257600080fd5b6100fa6104ca565b60405190815260200160405180910390f35b341561011757600080fd5b6100fa6104d0565b341561012a57600080fd5b6100fa6104d6565b341561013d57600080fd5b610157600435602435600160a060020a03604435166104dc565b005b341561016457600080fd5b61015760043561051b565b341561017a57600080fd5b610185600435610637565b604051901515815260200160405180910390f35b34156101a457600080fd5b6100fa61072b565b34156101b757600080fd5b610157600435610731565b34156101cd57600080fd5b6100fa610932565b34156101e057600080fd5b6101eb600435610938565b6040518080602001806020018d81526020018c81526020018b81526020018a815260200189815260200188815260200187815260200186600160a060020a0316600160a060020a0316815260200185600160a060020a0316600160a060020a0316815260200184600160a060020a0316600160a060020a0316815260200183810383528f8181546001816001161561010002031660029004815260200191508054600181600116156101000203166002900480156102ea5780601f106102bf576101008083540402835291602001916102ea565b820191906000526020600020905b8154815290600101906020018083116102cd57829003601f168201915b505083810382528e54600260001961010060018416150201909116048082526020909101908f90801561035e5780601f106103335761010080835404028352916020019161035e565b820191906000526020600020905b81548152906001019060200180831161034157829003601f168201915b50509e50505050505050505050505050505060405180910390f35b341561038457600080fd5b6101856004356109a4565b341561039a57600080fd5b610157600435610c3d565b34156103b057600080fd5b610157600435610cfb565b34156103c657600080fd5b6100fa60046024813581810190830135806020601f8201819004810201604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f01602080910402602001604051908101604052818152929190602084018383808284375094965050843594602081013594506040810135935060608101359250600160a060020a0360808201358116925060a09091013516610db9565b341561048357600080fd5b6100fa611038565b341561049657600080fd5b61015761103e565b34156104a957600080fd5b6100fa611040565b34156104bc57600080fd5b610185600435602435611046565b60075481565b60055481565b60035481565b826000838154811015156104ec57fe5b60009182526020808320600160a060020a039095168352600c600e909202909401019092526040909120555050565b600080548290811061052957fe5b90600052602060002090600e02016005015460008281548110151561054a57fe5b90600052602060002090600e02016006015401431180156105a95750600080548290811061057457fe5b90600052602060002090600e02016002015460008281548110151561059557fe5b90600052602060002090600e020160080154105b80156105d5575060025460008054839081106105c157fe5b90600052602060002090600e020160070154145b156106345760045460008054839081106105eb57fe5b90600052602060002090600e0201600701819055507fe7f1cfe053fc2bbc571230c463d10a23b8424854cf97cd5b620f838720454a4b8160405190815260200160405180910390a15b50565b600060015460008381548110151561064b57fe5b90600052602060002090600e0201600701541480156106975750600080548390811061067357fe5b600091825260209091206009600e90920201015433600160a060020a039081169116145b156107225760025460008054849081106106ad57fe5b90600052602060002090600e020160070181905550436000838154811015156106d257fe5b90600052602060002090600e0201600601819055507f1ed14d1c82b32f87579bf9a59adc718346491f0ae668b2d4354577952a0b8f378260405190815260200160405180910390a1506001610726565b5060005b919050565b60045481565b600060045460008381548110151561074557fe5b90600052602060002090600e020160070154141561092e57600080548390811061076b57fe5b60009182526020808320600160a060020a0333168452600d600e90930201919091019052604090205460ff16151561092e5760008054839081106107ab57fe5b60009182526020808320600160a060020a0333168452600c600e909302019190910190526040812054915081111561092e5760008054839081106107eb57fe5b600091825260208220600a600e909202010154600160a060020a03169063a9059cbb90339084906040516020015260405160e060020a63ffffffff8516028152600160a060020a0390921660048301526024820152604401602060405180830381600087803b151561085c57600080fd5b6102c65a03f1151561086d57600080fd5b5050506040518051905050600160008381548110151561088957fe5b90600052602060002090600e0201600d01600033600160a060020a0316600160a060020a0316815260200190815260200160002060006101000a81548160ff0219169083151502179055507f8b55b4a9c4ba203a41289841eb415f097efe595b2de4ccb9ffcd12672c0976e43382846040518084600160a060020a0316600160a060020a03168152602001838152602001828152602001935050505060405180910390a15b5050565b60015481565b600080548290811061094657fe5b60009182526020909120600e9091020160028101546003820154600483015460058401546006850154600786015460088701546009880154600a890154600b8a0154999a5060018b0199600160a060020a039283169291821691168c565b60008060006003546000858154811015156109bb57fe5b90600052602060002090600e020160070154148015610a1a575060008054859081106109e357fe5b90600052602060002090600e020160050154600085815481101515610a0457fe5b90600052602060002090600e0201600601540143115b15610c3157610a2884611446565b9150610a3384611479565b9050600084815481101515610a4457fe5b600091825260208220600a600e9092020101548154600160a060020a039091169163a9059cbb9187908110610a7557fe5b600091825260208220600b600e909202010154600160a060020a03169085906040516020015260405160e060020a63ffffffff8516028152600160a060020a0390921660048301526024820152604401602060405180830381600087803b1515610ade57600080fd5b6102c65a03f11515610aef57600080fd5b505050604051805150506000805485908110610b0757fe5b600091825260208220600a600e9092020101548154600160a060020a039091169163a9059cbb9187908110610b3857fe5b6000918252602082206009600e909202010154600160a060020a03169084906040516020015260405160e060020a63ffffffff8516028152600160a060020a0390921660048301526024820152604401602060405180830381600087803b1515610ba157600080fd5b6102c65a03f11515610bb257600080fd5b505050604051805150506007546000805486908110610bcd57fe5b90600052602060002090600e0201600701819055507e11edf6369ebff05535b74dd66796f9c99b87fdbf12c608e8f9c67393701e3d81838660405180848152602001838152602001828152602001935050505060405180910390a160019250610c36565b600092505b5050919050565b6000805482908110610c4b57fe5b60009182526020909120600b600e90920201015433600160a060020a039081169116148015610c9a57506001546000805483908110610c8657fe5b90600052602060002090600e020160070154145b15610634576005546000805483908110610cb057fe5b90600052602060002090600e0201600701819055507f29d5a3034fa43373d0906fc6a61564505d56be176d998c55c35b3f2aafd9dc368160405190815260200160405180910390a150565b6000805482908110610d0957fe5b600091825260209091206009600e90920201015433600160a060020a039081169116148015610d5857506001546000805483908110610d4457fe5b90600052602060002090600e020160070154145b15610634576006546000805483908110610d6e57fe5b90600052602060002090600e0201600701819055507f5f7ba52d3c146588ab2617bb1887a4e73c4747654352c00dff0fedb71bcfcaa38160405190815260200160405180910390a150565b6000806000610dc66116ec565b881580610dd1575089155b80610de757506b02e87669c308736a0400000089115b15610df157600080fd5b888a1115610dfe57600080fd5b68056bc75e2d63100000881115610e1457600080fd5b6005871080610e265750630d6d26b687115b15610e3057600080fd5b6001549250339150610180604051908101604052808d81526020018c81526020018b81526020018a8152602001898152602001888152602001600081526020018481526020016000815260200187600160a060020a0316815260200186600160a060020a0316815260200183600160a060020a0316815250905060008054806001018281610ebe9190611775565b600092835260209092208391600e0201815181908051610ee29291602001906117a6565b50602082015181600101908051610efd9291602001906117a6565b5060408201518160020155606082015181600301556080820151816004015560a0820151816005015560c0820151816006015560e08201518160070155610100820151816008015561012082015160098201805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a0392909216919091179055610140820151600a8201805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a0392909216919091179055610160820151600b91909101805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a0390921691909117905550506000547fffea853b7e555ac3cfd8aef6aa597437350d134073413cd56d2ecb6c0cd39061906000190160405190815260200160405180910390a15050600054600019019a9950505050505050505050565b60065481565b565b60025481565b60008060008381548110151561105857fe5b60009182526020909120600b600e90920201015433600160a060020a03908116911614806110b35750600080548490811061108f57fe5b600091825260209091206009600e90920201015433600160a060020a039081169116145b156110bd57600080fd5b8315806110d557506b033b2e3c9fd0803ce800000084115b156110df57600080fd5b60025460008054859081106110f057fe5b90600052602060002090600e020160070154148061112e5750600354600080548590811061111a57fe5b90600052602060002090600e020160070154145b1561143a57600080548490811061114157fe5b90600052602060002090600e02016005015460008481548110151561116257fe5b90600052602060002090600e020160060154014311151561143a57600080548490811061118b57fe5b90600052602060002090600e0201600801546000848154811015156111ac57fe5b90600052602060002090600e020160030154039050808411156111ce57600080fd5b60008054849081106111dc57fe5b600091825260208220600a600e909202010154600160a060020a0316906323b872dd903390309088906040516020015260405160e060020a63ffffffff8616028152600160a060020a0393841660048201529190921660248201526044810191909152606401602060405180830381600087803b151561125b57600080fd5b6102c65a03f1151561126c57600080fd5b50505060405180519050151561128157600080fd5b8360008481548110151561129157fe5b6000918252602082206008600e909202010180549092019091558054859190859081106112ba57fe5b60009182526020808320600160a060020a0333168452600c600e909302019190910190526040812080549092019091558054849081106112f657fe5b90600052602060002090600e02016003015460008481548110151561131757fe5b90600052602060002090600e020160080154141561133d57611338836114d8565b6113d8565b600080548490811061134b57fe5b90600052602060002090600e02016002015460008481548110151561136c57fe5b90600052602060002090600e020160080154101580156113ac5750600254600080548590811061139857fe5b90600052602060002090600e020160070154145b156113d85760035460008054859081106113c257fe5b90600052602060002090600e0201600701819055505b7fceebbe387e987cf36857a4e5fbb04e77efeb83be073cdfdf70894cf4506971fe3385856040518084600160a060020a0316600160a060020a03168152602001838152602001828152602001935050505060405180910390a16001915061143f565b600091505b5092915050565b600061145182611479565b600080548490811061145f57fe5b90600052602060002090600e020160080154039050919050565b600068056bc75e2d6310000060008381548110151561149457fe5b90600052602060002090600e0201600401546000848154811015156114b557fe5b90600052602060002090600e020160080154028115156114d157fe5b0492915050565b6000806007546000848154811015156114ed57fe5b90600052602060002090600e02016007018190555061150b83611446565b915061151683611479565b905060008381548110151561152757fe5b600091825260208220600a600e9092020101548154600160a060020a039091169163a9059cbb918690811061155857fe5b600091825260208220600b600e909202010154600160a060020a03169085906040516020015260405160e060020a63ffffffff8516028152600160a060020a0390921660048301526024820152604401602060405180830381600087803b15156115c157600080fd5b6102c65a03f115156115d257600080fd5b5050506040518051505060008054849081106115ea57fe5b600091825260208220600a600e9092020101548154600160a060020a039091169163a9059cbb918690811061161b57fe5b6000918252602082206009600e909202010154600160a060020a03169084906040516020015260405160e060020a63ffffffff8516028152600160a060020a0390921660048301526024820152604401602060405180830381600087803b151561168457600080fd5b6102c65a03f1151561169557600080fd5b50505060405180519050507f5ba568b2c8cacc0c609a35b10bf3cf7a82611318d294afcf2e385847570d432381838560405180848152602001838152602001828152602001935050505060405180910390a1505050565b61018060405190810160405280611701611824565b815260200161170e611824565b8152602001600081526020016000815260200160008152602001600081526020016000815260200160008152602001600081526020016000600160a060020a031681526020016000600160a060020a031681526020016000600160a060020a031681525090565b8154818355818115116117a157600e0281600e0283600052602060002091820191016117a19190611836565b505050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106117e757805160ff1916838001178555611814565b82800160010185558215611814579182015b828111156118145782518255916020019190600101906117f9565b506118209291506118d2565b5090565b60206040519081016040526000815290565b6118cf91905b8082111561182057600061185082826118ec565b61185e6001830160006118ec565b506000600282018190556003820181905560048201819055600582018190556006820181905560078201819055600882015560098101805473ffffffffffffffffffffffffffffffffffffffff19908116909155600a8201805482169055600b820180549091169055600e0161183c565b90565b6118cf91905b8082111561182057600081556001016118d8565b50805460018160011615610100020316600290046000825580601f106119125750610634565b601f01602090049060005260206000209081019061063491906118d25600a165627a7a723058202513092c89ac635bcf0b36cd56d0137b06bab202a258f418db12fa093aa7965c0029',
            gas: '4700000'
         }, function (e, crowdfundingContract) {
         if (typeof crowdfundingContract.address !== 'undefined') {
         console.log('Crowdfunding contract mined, address: ' + crowdfundingContract.address + ' tx: ' + crowdfundingContract.transactionHash);
         var elixirContract = web3.eth.contract([{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_amount","type":"uint256"}],"name":"approve","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_to","type":"address"},{"name":"_amount","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"amount","type":"uint256"}],"name":"importBalance","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_amount","type":"uint256"}],"name":"transfer","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"_owner","type":"address"},{"indexed":true,"name":"_spender","type":"address"},{"indexed":false,"name":"_value","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Transfer","type":"event"}]);
         var elixir = elixirContract.new(
         {
         from: web3.eth.accounts[0], 
         data: '0x6060604052341561000f57600080fd5b60408051908101604052600681527f656c697869720000000000000000000000000000000000000000000000000000602082015260009080516100569291602001906100b1565b5060408051908101604052600481527f454c4958000000000000000000000000000000000000000000000000000000006020820152600190805161009e9291602001906100b1565b506002805460ff1916601217905561014c565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100f257805160ff191683800117855561011f565b8280016001018555821561011f579182015b8281111561011f578251825591602001919060010190610104565b5061012b92915061012f565b5090565b61014991905b8082111561012b5760008155600101610135565b90565b6105d58061015b6000396000f3006060604052600436106100985763ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166306fdde03811461009d578063095ea7b31461012757806318160ddd1461015d57806323b872dd14610182578063313ce567146101aa57806370a08231146101d357806395d89b41146101f2578063a26a3a6814610205578063a9059cbb1461021d575b600080fd5b34156100a857600080fd5b6100b061023f565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156100ec5780820151838201526020016100d4565b50505050905090810190601f1680156101195780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561013257600080fd5b610149600160a060020a03600435166024356102dd565b604051901515815260200160405180910390f35b341561016857600080fd5b61017061034a565b60405190815260200160405180910390f35b341561018d57600080fd5b610149600160a060020a0360043581169060243516604435610350565b34156101b557600080fd5b6101bd610431565b60405160ff909116815260200160405180910390f35b34156101de57600080fd5b610170600160a060020a036004351661043a565b34156101fd57600080fd5b6100b0610455565b341561021057600080fd5b61021b6004356104c0565b005b341561022857600080fd5b610149600160a060020a03600435166024356104e1565b60008054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156102d55780601f106102aa576101008083540402835291602001916102d5565b820191906000526020600020905b8154815290600101906020018083116102b857829003601f168201915b505050505081565b600160a060020a03338116600081815260066020908152604080832094871680845294909152808220859055909291907f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9259085905190815260200160405180910390a35060015b92915050565b60035481565b600160a060020a0383166000908152600460205260408120548290108015906103a05750600160a060020a0380851660009081526006602090815260408083203390941683529290522054829010155b80156103ac5750600082115b80156103d15750600160a060020a038316600090815260046020526040902054828101115b156104265750600160a060020a0380841660009081526004602081815260408084208054879003905560068252808420338616855282528084208054879003905593861683525220805482019055600161042a565b5060005b9392505050565b60025460ff1681565b600160a060020a031660009081526004602052604090205490565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156102d55780601f106102aa576101008083540402835291602001916102d5565b600160a060020a033316600090815260046020526040902080549091019055565b600160a060020a03331660009081526004602052604081205482901080159061050a5750600082115b801561052f5750600160a060020a038316600090815260046020526040902054828101115b156105a157600160a060020a033381166000818152600460205260408082208054879003905592861680825290839020805486019055917fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9085905190815260200160405180910390a3506001610344565b5060006103445600a165627a7a723058202e74864e9c698dfd12c1a4e39905df274d216f26c1e1f6ed1ab1e7b2bb541c3c0029', 
         gas: '4700000'
         }, function (e, testToken){
         if (typeof testToken.address !== 'undefined') {
         	console.log('Test token contract mined, address: ' + testToken.address + ' tx: ' + testToken.transactionHash);
         	console.log('Crowdfunding Scenario 3: Insufficient funding (single user).');
         	var gasAmount = 2900000; // You can optimize the amount for each function call, as will be done in the app.
         	// Let's set up creator to be:
         	var creator=web3.eth.accounts[0];
         	// This is whoever is hosting/promoting the crowdfunding event:
         	var host=web3.eth.accounts[1];
         	// Set up the test users:
         	var user1=web3.eth.accounts[2];
         	// Add some initial balance to the users so they can pledge:
         	var user1InitialBalance = new web3.BigNumber('400000000000000000000');
         	testToken.importBalance(user1InitialBalance,{
                    from: user1,
                    gas: gasAmount
                }); 
                console.log('Initial balance of user 1: ' + testToken.balanceOf.call(user1));
         	// Set up the necessary parameters required when making a crowdfunding request:
         	var title='Title here';
         	var description='Description here';
         	var minGoal=new web3.BigNumber('400000000000000000001');
         	var maxGoal=new web3.BigNumber('1000000000000000000000');
         	var hostCut=new web3.BigNumber('25000000000000000000'); // 25% (specify in percent, with units of 10^-18 percent)
         	var duration=new web3.BigNumber('10'); // Keep low for testing.
         	var tokenAddress=testToken.address; // Set as the test token contract
         	console.log('Title: ' + title);
         	console.log('Description: ' + description);
         	console.log('Minimum goal: ' + minGoal);
         	console.log('Maximum goal: ' + maxGoal);
         	console.log('Host cut: ' + hostCut);
         	console.log('Duration: ' + duration);
         	console.log('Token address: ' + tokenAddress);
         	// Make the request:
          	crowdfundingContract.makeProposal(title,description,minGoal,maxGoal,hostCut,duration,host,tokenAddress,{
                    from: creator,
                    gas: gasAmount
                });
         	// View the new request:
         	var index=0;
         	var idea1 = crowdfundingContract.ideas.call(index);
         	console.log('Crowdfunding request made (status=1): ' + idea1);
         	crowdfundingContract.acceptProposal(index,{
                    from: host,
                    gas: gasAmount
                });
            idea1 = crowdfundingContract.ideas.call(index);
         	console.log('First crowdfunding idea is now accepted (status=2): ' + idea1);
         	//	Fist user is now going to pledge:
          	var user1Amount=new web3.BigNumber('400000000000000000000');
         	//	Approve the smart contract to move funds on their behalf:
         	testToken.approve(crowdfundingContract.address,user1Amount,{
                    from: user1,
                    gas: gasAmount
                });
         	crowdfundingContract.pledgeTokens(user1Amount,index,{
                    from: user1,
                    gas: gasAmount
                });
            idea1 = crowdfundingContract.ideas.call(index);
         	console.log('Crowdfunding idea after only pledge: ' + idea1);
         	console.log('No other users decide to join during crowdfunding duration...');
            console.log('Balance of user 1: ' + testToken.balanceOf.call(user1));
            console.log('Balance of contract: ' + testToken.balanceOf.call(crowdfundingContract.address));
         	console.log('Balance of creator: ' + testToken.balanceOf.call(creator));
         	console.log('Balance of host:    ' + testToken.balanceOf.call(host));
         	// Either the host of creator need to wait out the duration and then the claim period begins...
         	for (i = 0; i < 30; i++) {
               	        crowdfundingContract.advanceBlock();
                }
         	crowdfundingContract.stateFail(index,{
                    from: user1,
                    gas: gasAmount
                });
                idea1 = crowdfundingContract.ideas.call(index);
                console.log('Crowdfunding idea after stating failure (status=4): ' + idea1);
         	crowdfundingContract.reclaimTokens(index,{
                    from: user1,
                    gas: gasAmount
                });
                console.log('Balance of user 1 after reclaiming funds: ' + testToken.balanceOf.call(user1));
                console.log('Balance of crowdfunding contract after user 1 has reclaimed funds: ' + testToken.balanceOf.call(crowdfundingContract.address));
                console.log('Scenario 3 complete.')
        }})
}})
      </script>
   </body>
</html>